<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OHIF Viewer redirect page</title>
  </head>
  <body>
    <p>Redirecting you to OHIF</p>
    <script>
        const params = new URLSearchParams(window.location.search);
        if (!params.has("StudyInstanceUIDs")) {
            console.error("Missing StudyInstanceUIDs in url");
        }
        if (!params.has("token")) {
            console.error("Missing token in url");
        }
        const studyInstanceUIDs = params.get("StudyInstanceUIDs");
        const token = params.get("token");

        // store the token into a cookie (as of v3-stable 2023.04.13, we have not found a way to pass tokens in url)
        document.cookie = "token=" + token + "; max-age=3600; path=/; secure; samesite=lax";  // no expiry date -> the cookie shall be deleted when the browser is closed

        const newUrl = "/viewer?StudyInstanceUIDs=" + studyInstanceUIDs;
        console.log("will redirect you to ", newUrl)
        if (!params.has("skip-redirect")) {
            window.location.href = newUrl;
        }
    </script>
  </body>
</html>
